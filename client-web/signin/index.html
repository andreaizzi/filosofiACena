<!DOCTYPE html>
<html>

<head>
    <title>Registrazione</title>
</head>

<body>
    <div class="rounded-box">
        <form id="signInForm">
            <label for="name">Nome:</label>
            <input type="text" id="name" name="name" required>
            <label for="surname">Cognome:</label>
            <input type="text" id="surname" name="surname" required>
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required>
            <label for="cf">Codice Fiscale:</label>
            <input type="text" id="cf" name="cf" required>

            <button type="submit">Registrati</button>
        </form>
    </div>

    <link rel="stylesheet" href="/styles/style.css">

    <script src="/scripts/api.js"></script>

    <script>
        const storedUserId = localStorage.getItem('userId');

        if (storedUserId) {
            getUser(storedUserId).then(user => {
                window.location.href = '../dashboard/';
            }).catch(error => {
                console.error('Stored userId is invalid. Removing from localStorage.', error);
                localStorage.removeItem('userId');
            });
        }

        document.getElementById('signInForm').addEventListener('submit', async (event) => {
            event.preventDefault();

            const name = document.getElementById('name').value;
            const surname = document.getElementById('surname').value;
            const email = document.getElementById('email').value;
            const cf = document.getElementById('cf').value;

            try {
                const user = await createUser(name, surname, email, cf);
                alert('Utente creato con successo! Id: ' + user.id);
                window.location.href = '../login/';
            } catch (error) {
                console.error('Error creating user:', error);
                alert(error.message || 'Si è verificato un errore durante la registrazione. Riprova più tardi.');
            }
        });
    </script>
</body>

</html>